<!DOCTYPE html>
<html>
<head>
    <title>Select Camera</title>
</head>
<body>
<div id="container">
    <video autoplay="true" id="videoElement" controls height="540" width="960" muted></video>
</div>
<div>
    <label for="cameraSelect">Select Camera:</label>
    <select id="cameraSelect"></select>
    <button id="startButton">Start Camera</button>
</div>
<script>
    const videoElement = document.querySelector("#videoElement");
    const cameraSelect = document.querySelector("#cameraSelect");
    const startButton = document.querySelector("#startButton");
    let currentStream = null;

    function stopMediaTracks(stream) {
        stream.getTracks().forEach(track => {
            track.stop();
        });
    }

    function gotDevices(deviceInfos) {
        cameraSelect.innerHTML = '';
        deviceInfos.forEach((deviceInfo) => {
            if (deviceInfo.kind === 'videoinput') {
                const option = document.createElement('option');
                option.value = deviceInfo.deviceId;
                option.text = deviceInfo.label || `Camera ${cameraSelect.length + 1}`;
                cameraSelect.appendChild(option);
            }
        });
    }

    function getStream(deviceId) {
        if (currentStream) {
            stopMediaTracks(currentStream);
        }
        const constraints = {
            video: { deviceId: deviceId ? { exact: deviceId } : undefined },
            audio: true
        };
        navigator.mediaDevices.getUserMedia(constraints)
            .then((stream) => {
                currentStream = stream;
                videoElement.srcObject = stream;
            })
            .catch((error) => {
                console.error("Error accessing media devices.", error);
            });
    }

    function startCamera() {
        const videoSource = cameraSelect.value;
        getStream(videoSource);
    }

    navigator.mediaDevices.enumerateDevices()
        .then(gotDevices)
        .catch(function(error) {
            console.error("Error enumerating devices.", error);
        });

    startButton.addEventListener('click', startCamera);

    // Automatically start the camera with the first available device on page load
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(function(stream) {
            currentStream = stream;
            videoElement.srcObject = stream;
        })
        .catch(function(error) {
            console.error("Error accessing media devices.", error);
        });
</script>
</body>
</html>
